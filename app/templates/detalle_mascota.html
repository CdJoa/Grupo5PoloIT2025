{% extends "base.html" %}

{% block content %}
<h2>{{ mascota.nombre }} </h2>

<div style="display: flex; gap: 10px;">
    {% for img in imagenes %}
        <div style="position: relative; display: inline-block;">
            <img src="{{ img.imagen.url }}" width="200">
        </div>
    {% endfor %}
</div>

<p><strong>Edad:</strong> {{ mascota.edad }}</p>
<p><strong>Especie:</strong> {{ mascota.especie }}</p>
<p><strong>Descripción:</strong> {{ mascota.descripcion }}</p>
<p><strong>Castrado:</strong> {{ mascota.castrado|yesno:"Sí,No" }}</p>
<p><strong>Provincia:</strong> {{ mascota.provincia}}</p>
<p><strong>Localidad:</strong> {{ mascota.localidad }}</p>

{% if user.is_authenticated %}
    {% if mascota.duenio == user %}
        <h3>Solicitudes de adopción recibidas</h3>
        <ul>
        {% for solicitud in mascota.solicitudes.all %}
            <li>
                Solicitante: {{ solicitud.solicitante.username }}<br>
                Estado: {{ solicitud.estado }}<br>
                {% if solicitud.estado == "pendiente" %}
                    <form method="post" action="{% url 'responder_solicitud' solicitud.id %}">
                        {% csrf_token %}
                        <button name="accion" value="aceptar">Aceptar</button>
                        <button name="accion" value="rechazar">Rechazar</button>
                    </form>
                {% elif solicitud.estado == "aceptada" %}
                    <a href="{% url 'chat_solicitud' solicitud.id %}">Ir al chat</a>
                {% elif solicitud.estado == "rechazada" %}
                    <span style="color: red;">(Solicitud rechazada)</span>
                {% endif %}
            </li>
        {% empty %}
            <li>No hay solicitudes para esta mascota.</li>
        {% endfor %}
        </ul>
    {% elif mascota.duenio != user %}
        <form method="post" action="{% url 'solicitar_mascota' mascota.id %}">
            {% csrf_token %}
            <button type="submit">Solicitar adopción</button>
        </form>
    {% endif %}
{% else %}
    <a href="{% url 'login' %}?next={% url 'detalle_mascota' mascota.id %}">Iniciá sesión para solicitar adopción</a>
{% endif %}

<a href="{% url 'perfil_usuario' %}">Volver a mi perfil</a>
{% endblock %}